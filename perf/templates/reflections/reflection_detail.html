{% extends "base.html" %}
{% load crispy_forms_tags static %}



{% block content %}


<div class="row">
 
  <div class="col-12 col-md-12 col-lg-6 order-1 order-md-1">

    <h3 class="text-primary"><i class="fas fa-user"></i> {{ reflection.teacher }}</h3>
    <p class="text-muted">{{ reflection.teacher.department }} | {{ reflection.date_created|date:"d M Y" }}</p>
    
    <!-- Reflection Domains -->
  <h4 class="mt-4">Reflection Domains</h4>
  {% if reflection.reflection_domains.all %}
    {% for rd in reflection.reflection_domains.all %}
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h5 class="card-title">{{ rd.domain.name }}</h5>

          <p><strong>Strengths:</strong>
            {% if rd.strengths.all %}
              {{ rd.strengths.all|join:", " }}
            {% else %}
              — 
            {% endif %}
          </p>

          <p><strong>Growth Areas:</strong>
            {% if rd.growths.all %}
              {{ rd.growths.all|join:", " }}
            {% else %}
              — 
            {% endif %}
          </p>

          <p><strong>Next Steps:</strong> {{ rd.next_steps|default:"—" }}</p>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>No domains added for this reflection.</p>
  {% endif %}

  </div>

  <div class="col-12 col-md-12 col-lg-6 order-2 order-md-2">
    
    <div class="row">
      <div class="col-12">
        <h5 class="mt-5 text-muted">Growth Plans</h5>
    {% if reflection.growth_plans.all %}
    {% for gp in reflection.growth_plans.all %}
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title">Growth Plan {{ forloop.counter }}</h5><br>

          <p><b>Goal:</b> {{ gp.goal_statement }}</p>
          <p><b>Components Addressed:</b> {{ gp.components_addressed.all|join:", " }}</p>
          <p><b>Indicators of Success:</b> {{ gp.indicators_of_success }}</p>
          <p><b>Actions:</b> {{ gp.actions }}</p>
          <p><b>Timelines:</b> {{ gp.timelines }}</p>
          <p><b>Resources:</b> {{ gp.resources|default:"—" }}</p>
          <p><b>Evaluator:</b> {{ gp.evaluator_name }}</p>
          <p><b>Date:</b> {{ gp.date }}</p>

          <!-- Observation Comments -->
          {% if gp.observation %}
          <div class="post">
            <div class="user-block">
              <img class="img-circle img-bordered-sm" src="{% static "dist/img/avatar.png" %}" alt="user image">
              <span class="username">
                <a href="#">HOD's Comment</a>
              </span>
            </div>
            <!-- /.user-block -->
            <p>
              {{ gp.observation.hod_comment|default:"—" }}
            </p>
          </div>

          <div class="post">
            <div class="user-block">
              <img class="img-circle img-bordered-sm" src="{% static "dist/img/avatar.png" %}" alt="user image">
              <span class="username">
                <a href="#">Program Coordinator's Comment</a>
              </span>
            </div>
            <!-- /.user-block -->
            <p>
              {{ gp.observation.coordinator_comment|default:"—" }}
            </p>
          </div>

          <div class="post">
            <div class="user-block">
              <img class="img-circle img-bordered-sm" src="{% static "dist/img/avatar.png" %}" alt="user image">
              <span class="username">
                <a href="#">Vice Pricipal's Comment</a>
              </span>
            </div>
            <!-- /.user-block -->
            <p>
              {{ gp.observation.prin_comment|default:"—" }}
            </p>
          </div>
          {% endif %}

          <!-- HOD Form -->
          {% if is_hod %}
            <div class="mt-3">
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="growth_plan_id" value="{{ gp.id }}">
                {{ form.hod_comment|as_crispy_field }}
                <button type="submit" class="btn btn-primary btn-sm mt-2">Save Comment</button>
              </form>
            </div>
          {% endif %}

          <!-- Coordinator Form -->
          {% if is_pc %}
            <div class="mt-3">
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="growth_plan_id" value="{{ gp.id }}">
                {{ form.coordinator_comment|as_crispy_field }}
                <button type="submit" class="btn btn-success btn-sm mt-2">Save Comment</button>
              </form>
            </div>
          {% endif %}

          <!-- principal Form -->
          {% if is_prin %}
            <div class="mt-3">
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="growth_plan_id" value="{{ gp.id }}">
                {{ form.prin_comment|as_crispy_field }}
                <button type="submit" class="btn btn-success btn-sm mt-2">Save Comment</button>
              </form>
            </div>
          {% endif %}

        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>No growth plans found for this reflection.</p>
  {% endif %}
      </div>
    </div>
  </div>
</div>


{% endblock content %}